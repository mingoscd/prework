<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Exercise 2</title>
		<link rel="stylesheet" href="../estilos.css">
		<link rel="stylesheet" href="rover.css">
	</head>
	<body>
		<header>
			<figure>
				<img src="http://tech.co/wp-content/uploads/2014/04/iron_hack.png" alt="">
			</figure>
			<div>
				<h1>Javascript prework</h1>
			</div>
		</header>
		<section>
			<h3><strong>Exercise 2:</strong></h3>
			<p>The Mars Rover Kata is an exercise taken from the prework sou you should have faced it before. Here you have the formulation, try to finish a working version before assiting to the classroom:</p>
			<ul class="specifications">
				<li>Develop an api that moves a rover around on a grid.</li>
				<li>You are given the initial starting point (x,y) of a rover and the direction (N,S,E,W) it is facing.</li>
				<li>The rover receives a character array of commands.</li>
				<li>Implement commands that move the rover forward/backward (f,b).</li>
				<li>Implement commands that turn the rover left/right (l,r).</li>
				<li>Implement wrapping from one edge of the grid to another. (planets are spheres after all)</li>
				<li>Implement obstacle detection before each move to a new square. If a given sequence of commands encounters an obstacle, the rover moves up to the last possible point and reports the obstacle.</li>
			</ul>
			<br>
			<div class="console-rover">
				<form action="">
					<fieldset>
						<legend>Grid Generation</legend>
						<span class="form-label">Width:</span><input id="gridX" type="number" placeholder="max = 7"><br> 
						<span class="form-label">Height:</span><input id="gridY" type="number" placeholder="max = 7"><br>
						<input type="submit" class="gen-button" value="Generate Grid" onclick="generateGrid();return false;">
						<p id="grid-generation-result"></p> 
					</fieldset>
					<fieldset>
						<legend>Obstacle Generation</legend>
						<span class="form-label">X position:</span><input id="obstacleX" type="number"><br> 
						<span class="form-label">Y position:</span><input id="obstacleY" type="number"><br>
						<input type="submit" class="gen-button" value="Generate Obstacle" onclick="generateObstacle();return false;">
						<p id="obstacle-generation-result"></p> 
					</fieldset>
					<fieldset>
						<legend>Rover Generation</legend>
						<span class="form-label">X position:</span><input id="roverX" type="number"><br> 
						<span class="form-label">Y position:</span><input id="roverY" type="number"><br>
						<span class="form-label">Orientation:</span>
							<select name="orientation" id="roverOrientation">
								<option value="e" selected>East</option>
								<option value="s">South</option>
								<option value="w">West</option>
								<option value="n">North</option>
							</select><br>
						<input type="submit" class="gen-button" value="Generate Rover" onclick="generateRover();return false;">
						<p id="rover-generation-result"></p> 
					</fieldset>
					<fieldset>
						<legend>Rover Move</legend>
						<span>You can move the Rover using the keyboard or pressing this buttons</span><br>
						<button class="key gen-button" onclick="Rover.move('f');draw();return false;">W</button><br>
						<button class="key gen-button" onclick="Rover.move('l');draw();return false;">A</button>
						<button class="key gen-button" onclick="Rover.move('b');draw();return false;">S</button>
						<button class="key gen-button" onclick="Rover.move('r');draw();return false;">D</button>
						<p id="rover-move-result"></p> 
					</fieldset>
				</form>
			</div>
			<div class="canvas-div">
				<canvas id="moon" width="700px" height="700px"></canvas>
			</div>

		</section>
	</body>
	<script src="rover.js"></script>
	<script type="text/Javascript">
		function generateGrid(){
			x = parseInt( document.getElementById("gridX").value);
			y = parseInt( document.getElementById("gridY").value);
			if( checkUnits(x, y, 7, 7) ){
				Grid.init(x,y);
				Grid.obstacle = [];
				document.getElementById("grid-generation-result").innerHTML = "Grid Generated Correctly";
				draw();
			}else{
				document.getElementById("grid-generation-result").innerHTML = "Grid Size Incorrect";
			}
		}

		function generateObstacle(){
			if( typeof(Grid) != 'undefined'){
				x = parseInt( document.getElementById("obstacleX").value);
				y = parseInt( document.getElementById("obstacleY").value);
				if( checkUnits(x, y, Grid.sizeX, Grid.sizeY) ){
					obstacle = [ document.getElementById("obstacleX").value, document.getElementById("obstacleY").value ];
					Grid.setObstacles(obstacle);
					document.getElementById("obstacle-generation-result").innerHTML = "Obstacle generated!";
					draw();
				}else{
					document.getElementById("obstacle-generation-result").innerHTML = "Obstacle Position Incorrect";
				}
			}else{
				document.getElementById("obstacle-generation-result").innerHTML = "First you must generate a grid!";
			}
		}

		function generateRover(){
			if( typeof(Grid) != 'undefined'){
				x = parseInt( document.getElementById("roverX").value);
				y = parseInt( document.getElementById("roverY").value);
				orientation = document.getElementById("roverOrientation").value;
				if( checkUnits(x, y, Grid.sizeX, Grid.sizeY) ){
					Rover.init(x, y, orientation);
					document.getElementById("rover-generation-result").innerHTML = "Rover generated!";
					draw();
				}else{
					document.getElementById("rover-generation-result").innerHTML = "Rover Position Incorrect";
				}
			}else{
				document.getElementById("rover-generation-result").innerHTML = "First you must generate a grid!";
			}
		}

		function moveRover(event){
			switch(event.keyCode){
				case 87: //w
					Rover.move('f');
					draw();
				break;
				case 65: //a
					Rover.move('l');
					draw();
				break;
				case 83: //s
					Rover.move('b');
					draw();
				break;
				case 68: //d
					Rover.move('r');
					draw();
				break;
				default: break;
			}
		}

		function checkUnits(x,y,maxX,maxY){ 
			result = ( (x<=0 || x > maxX || isNaN(x)) || (y<=0 || y > maxY || isNaN(y)) )? false:true;
			return result;
		}
	</script>
	<script type ="text/Javascript">
		(function(){ 
			window.onkeyup = moveRover; 
			var canvas = document.getElementById("moon");
	    	moon = canvas.getContext("2d");
	    	bg = new Image();
	    	bg.src = 'http://s2.www.astronomycameras.com/data/blog/20120213/assets/houston_moon_zoom.jpg'
	    	rock = new Image();
	    	rock.src = 'rock.png';
	    	rocketR = new Image();
			rocketL = new Image();
			rocketU = new Image();
			rocketD = new Image();
	    	rocketR.src = 'rocketR.png';
	    	rocketL.src = 'rocketL.png';
	    	rocketU.src = 'rocketU.png';
	    	rocketD.src = 'rocketD.png';
		})();

		function draw(){
			if(Grid){
				moon.clearRect ( 0 , 0 , 700, 700 );
				moon.width = Grid.sizeX*100;
				moon.height = Grid.sizeY*100;
				moon.drawImage(bg,0,0, moon.width, moon.height);
				hei = moon.height/Grid.sizeY;
				wid = moon.width/Grid.sizeX;			
			}
			if(Grid.obstacles){
				for( var i=0; i<Grid.obstacles.length; i++){
					posX = (Grid.obstacles[i][0]*100)-100;
					posY = ( Grid.sizeY - Grid.obstacles[i][1] ) * 100;
					moon.drawImage(rock,posX,posY,wid,hei);
				}	
			}
			if(Rover.position){
				//patch to diferent units (0-Grid.sizeX-1) to (1-Grid.sizeX)
				posX = (Rover.position[0] == 0)?(Grid.sizeX*100)-100:(Rover.position[0]*100)-100;
				posY = (Rover.position[1] == 0)?0:( Grid.sizeY - Rover.position[1] ) * 100;
				switch(Rover.orientation){
					case 'e': moon.drawImage(rocketR,posX,posY,wid,hei);
					break;
					case 'n':moon.drawImage(rocketU,posX,posY,wid,hei);
					break;
					case 's': moon.drawImage(rocketD,posX,posY,wid,hei);
					break;
					case 'w': moon.drawImage(rocketL,posX,posY,wid,hei);
					break;
					default: break;
				} 
			}
		}
	</script>
</html>